[project]
name = "tmgg"
version = "0.1.0"
description = "Graph denoising experiments with Hydra and PyTorch Lightning"
authors = [{ name = "Igor Krawczuk", email = "igor@adaptyvbio.com" }]
requires-python = ">=3.11,<3.13"
readme = "README.md"
dependencies = [
  "torch>=1.12.0",
  "pytorch-lightning>=2.0.0",
  "hydra-core>=1.3.0",
  "omegaconf>=2.3.0",
  "numpy>=1.21.0",
  "scipy>=1.7.0",
  "matplotlib>=3.5.0",
  "wandb>=0.20.1",
  "tqdm>=4.64.0",
  "rich>=13.0.0",
  "networkx>=3.5",
  "tensorboardx>=2.6.4",
  "loguru>=0.7.3",
  "tensorboard>=2.20.0",
  "jupyter>=1.1.1",
  "torchshow>=0.5.2",
  "click>=8.0.0",
  "pyarrow>=14.0.0",
  "tenacity>=8.0.0",
  "pandas>=2.0.0",
  "seaborn>=0.13.2",
  "s3fs>=2025.12.0",
  "tbparse>=0.0.9",
  "tensorflow>=2.18.0",  # NumPy 2.x compatibility (tbparse dep)
]

[project.optional-dependencies]
test = ["pytest>=7.0.0", "pytest-cov>=4.0.0"]
cloud = ["boto3>=1.26.0"]                     # S3-compatible storage for Tigris/AWS

[project.scripts]
tmgg-attention = "tmgg.experiments.attention_denoising.runner:main"
tmgg-digress = "tmgg.experiments.digress_denoising.runner:main"
tmgg-gnn = "tmgg.experiments.gnn_denoising.runner:main"
tmgg-hybrid = "tmgg.experiments.hybrid_denoising.runner:main"
tmgg-grid-search = "tmgg.experiments.grid_search_runner:main"
# Stage-specific runners (spectral denoising experiments)
tmgg-stage1 = "tmgg.experiments.stages.runner:stage1"
tmgg-stage1-sanity = "tmgg.experiments.stages.runner:stage1_sanity"
tmgg-stage1-5 = "tmgg.experiments.stages.runner:stage1_5"
tmgg-stage2 = "tmgg.experiments.stages.runner:stage2"
tmgg-stage3 = "tmgg.experiments.stages.runner:stage3"
tmgg-stage4 = "tmgg.experiments.stages.runner:stage4"
tmgg-stage5 = "tmgg.experiments.stages.runner:stage5"
# Spectral denoising (generic entry point)
tmgg-spectral = "tmgg.experiments.spectral_denoising.runner:main"
# W&B data export utility
tmgg-wandb-export = "tmgg.experiment_utils.wandb_export.cli:main"
# TensorBoard data export utility
tmgg-tb-export = "tmgg.experiment_utils.tensorboard_export.cli:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.uv]
dev-dependencies = ["pytest>=8.4.1", "hypothesis>=6.0.0", "pdbpp>=0.11.6"]

[tool.hatch.metadata]
allow-direct-references = true

[tool.hatch.build.targets.wheel]
packages = ["src/tmgg"]

# Include YAML config files in the wheel for Modal/cloud deployments
[tool.hatch.build.targets.wheel.force-include]
"src/tmgg/exp_configs" = "tmgg/exp_configs"

[tool.hatch.build.targets.sdist]
include = ["src/tmgg/**/*.py", "src/tmgg/**/*.yaml", "src/tmgg/**/*.yml"]

[dependency-groups]
dev = ["basedpyright>=1.31.1"]
